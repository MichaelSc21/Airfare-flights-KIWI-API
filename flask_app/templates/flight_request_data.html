{% extends "layout.html" %}
{% block content %}

	<div class="loading-container">
		<div class="loading-spinner"></div>
		<div class="loading-text">Loading... This will take a minute</div>
	</div>
	<div class="row p-1">
		<div class="card m-auto" style="width: 90%;">
			<div class="card-body">
				<div class="chart"></div>
				<p class="chart">Lorem ipsum dolor sit amet consectetur adipisicing elit. 
					Quibusdam beatae eos esse hic tempore, itaque dolor quod. Eligendi debitis 
					doloremque itaque architecto velit autem suscipit ut laborum optio maxime at 
					facere perspiciatis quae molestiae nemo, saepe impedit. Quaerat corporis eius 
					libero fugit. Debitis non nobis repudiandae ex soluta vero repellendus omnis eos, 
					voluptate mollitia dolorem asperiores sint itaque consequuntur voluptatum totam 
					fugit aut nemo maiores! Laboriosam quidem error possimus nobis eligendi dolor aut 
					ullam voluptas officiis similique placeat modi, eaque voluptates dolores odit optio, 
					pariatur molestias. Eum praesentium totam error aliquam,
					tempore in quia exercitationem! Temporibus corporis asperiores esse ipsum?</p>
			</div>
		</div>
	</div>
		
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<!--<script type="text/javascript">
			$(document).ready(function() {	
				var intervalId = setInterval(function() {
					// Send AJAX request to Flask app to check for JSON data
					$.ajax({
						url: '/get_result',  // replace with your Flask route for checking data
						type: 'GET',
						success: function(response) {
							// If JSON data is available, handle it
							if (response.response) {
								clearInterval(intervalId);  // stop polling
								document.querySelector('.loading-container').style.display = 'none';
								//document.querySelector('.chart1').style.display = 'block';
								//document.getElementById('result').innerHTML = data.result;
								var graphs1 = JSON.parse(response.data);
								var chart = document.getElementsByClassName('chart')[0];
								// Add a css class created in the main.css to slide the items from the left
								chart.classList.add('show')
								document.querySelector('p.chart').classList.add('show')
								Plotly.newPlot(chart, graphs1.data,{});
							}
						}
					});
				}, 10000);  // polling interval in milliseconds (e.g. 3000 ms = 3 seconds)
			});
		</script>-->
		
		<script type="text/javascript">
			// Use Jinja syntax to get the value of the session variable 'json_graph'
			var graphs1 = {{ session["json_graph"]|default("null") | safe}};
			
			// Check if session variable 'json_graph' exists
			if (graphs1 !== null) {
				console.log('It already has the json_graph session variable saved')
				// If session variable exists, render graph using data from session
				document.querySelector('.loading-container').style.display = 'none';
				var chart = document.getElementsByClassName('chart')[0];
				// Add a css class created in the main.css to slide the items from the left
				chart.classList.add('show')
				document.querySelector('p.chart').classList.add('show')

				Plotly.newPlot(chart, graphs1,{});
			} else {
				$(document).ready(function() {	
					fetch('/get_result')  
						.then(function(response) {
							if (!response.response) {
								console.log('it fetched the data from the get_result flask route')
								document.querySelector('.loading-container').style.display = 'none';
								console.log(response.data)
								graphs1 = JSON.parse(response.data);
								var chart = document.getElementsByClassName('chart')[0];
								// Add a css class created in the main.css to slide the items from the left
								chart.classList.add('show')
								document.querySelector('p.chart').classList.add('show')
								Plotly.newPlot(chart, graphs1.data,{});
							};
							
						});
				});
			}	

				
		</script>
	{% endblock %}